---
import { ArrowRight } from "@lucide/astro";
import Project from "../components/v2/Project.astro";
import { PROJECTS } from "../config/Projects";
import Layout from "../layouts/Layout.astro";
import { SEO } from "astro-seo";

const me = {
  name: "Varun Sahni",
  tagline:
    "Purdue CS/CE '28 · systems & computer architecture · spanning CS + ECE",
  email: "contact@vsahni.me",
  phone: "510-944-7378",
  github: "https://github.com/notskamr",
  site: "https://vsahni.me",
  blog: "https://blog.vsahni.me",
  resume: "/resume.pdf",
};

const socials = [
  { t: "GitHub", u: me.github },
  { t: "Blog", u: me.blog },
  { t: "Email", u: `mailto:${me.email}` },
  { t: "Resume (PDF)", u: me.resume },
];

const experience = [
  {
    org: "Paasa (YC S24)",
    role: "Full-Stack Developer Intern",
    when: "Nov 2024 — Jan 2025",
    pts: [
      "Built admin panel (React/Python/SQL) → 3x advisor productivity.",
      "Deployed AWS infra; ~80% cost reduction.",
      "Contributed mobile light-mode UI + WhatsApp AI MCP server.",
    ],
  },
  {
    org: "CortX (Healthcare startup)",
    role: "Co-Founder & Founding Engineer",
    when: "2021 — 2022",
    pts: [
      "One of 5 core founders; led full-stack (React + Express).",
      "Designed 'health-audit' algorithm to consolidate patient histories.",
      "Work recognized by Young Changemaker Award (Govt. of India).",
    ],
  },
];

const projects = PROJECTS.slice(0, 6);

const research = [
  "Self-directed CV/ML: lightweight CNN for GI disorder detection (97.82% on HyperKvasir).",
  "Presented at UMich AI Symposium, IEEE CICT, SLAS Data 2024, SCCUR, IFIC Zhejiang Lab.",
  "First-author IEEE paper pending.",
];

const leadership = [
  "Head of ICT — The Shri Ram School: ran ShriTeq (90+ schools), AI & Cybersecurity Weeks (800+ students).",
  "Launched Parallelized — India's first performance-aware programming contest.",
  "Hack Club — member & mentor; Pure Hearts co-founder (3K+ beneficiaries; 500+ volunteers; $30K+ raised).",
];

const education = [
  {
    school: "Purdue University",
    sub: "B.S. Computer Science ('28) · spanning CS & ECE",
    loc: "West Lafayette, IN",
    items: [
      "3.92 GPA, Dean's List",
      "ECE 264 (Advanced C Programming)",
      "CS 180 (Object-Oriented Programming)",
      "Interests: Arch, Systems, AI/ML",
    ],
  },
  {
    school: "UC Berkeley — Summer Sessions",
    sub: "CS61C (A-), Data 8 (B+)",
    loc: "Berkeley, CA",
    items: [
      "CS 61C, computer architecture: boolean logic, C, assembly, memory hierarchy, pipelining, parallelism; built a 5-stage pipelined RISC-V CPU in Logisim.",
      "DATA 8: inference on real-world datasets using Python/NumPy/Pandas.",
    ],
  },
];

const skills = [
  {
    k: "Languages",
    v: "Python, C, Java, JavaScript/TypeScript, SQL (PostgreSQL, libSQL), RISC-V",
  },
  {
    k: "Frameworks",
    v: "React, Next.js, Svelte, Astro, Bun, Node.js, Flask, FastAPI, Django, NestJS, Express, TailwindCSS",
  },
  { k: "ML", v: "NumPy, Pandas, scikit-learn, TensorFlow, PyTorch, Keras" },
  { k: "Tools", v: "Git, Docker, VS Code" },
];
---

<Layout title="Varun Sahni — Portfolio" bodyClass="min-h-screen">
  <SEO
    slot="headTop"
    title="Varun Sahni — Portfolio"
    description="Varun Sahni — Purdue CS '28. Systems & computer architecture. Open-source, research, and products."
    canonical={me.site}
  />

  <main
    class="mx-auto max-w-5xl px-4 py-8 lg:py-12 selection:bg-yellow-300/40 dark:selection:bg-amber-400/20"
  >
    <!-- top -->
    <header class="flex flex-col gap-3">
      <div class="flex flex-wrap items-end justify-between gap-3">
        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">
          {me.name}
        </h1>
      </div>
      <p class="text-neutral-600 dark:text-neutral-200">{me.tagline}</p>
      <nav class="flex flex-wrap gap-2" aria-label="Primary">
        {
          socials.map((s) => (
            <a
              href={s.u}
              class="inline-flex items-center gap-2 rounded-full bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 px-3 py-1 text-sm shadow-sm hover:shadow transition"
              rel="noopener noreferrer"
            >
              {s.t}
            </a>
          ))
        }
      </nav>

      <!-- song now playing (np.vsahni.me) -->
      <div class="mt-3 flex flex-wrap items-center gap-2 text-sm">
        <span class="font-semibold">Now Playing:</span>
        <span id="np-loading" class="dark:text-neutral-300 text-neutral-500"
          >Loading…</span
        >
        <a
          id="np-link"
          href="#"
          class="opacity-0 transition-opacity underline underline-offset-2"></a>
      </div>
    </header>

    <!-- about me -->
    <section class="mt-8">
      <h2
        class="text-xs font-semibold uppercase tracking-[0.18em] dark:text-neutral-300 text-neutral-500"
      >
        About
      </h2>
      <p class="mt-2 leading-relaxed">
        I build where hardware meets software—<span class="font-medium"
          >RISC-V & memory hierarchies</span
        > up to
        <span class="font-medium">reliable web systems</span>. I like to find
        community and share knowledge. I ship fast, document well, and keep
        things <a href="https://grugbrain.dev/" target="_blank">simple</a>.
      </p>
    </section>

    <!-- experience -->
    <section class="mt-10">
      <h2
        class="text-xs font-semibold uppercase tracking-[0.18em] dark:text-neutral-300 text-neutral-500"
      >
        Experience
      </h2>
      <div class="mt-3 grid gap-3">
        {
          experience.map((e) => (
            <article class="rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-4">
              <div class="flex flex-wrap items-baseline justify-between gap-2">
                <h3 class="font-semibold">
                  {e.org} — {e.role}
                </h3>
                <span class="text-xs dark:text-neutral-300 text-neutral-500">
                  {e.when}
                </span>
              </div>
              <ul class="mt-2 list-disc pl-5 space-y-1">
                {e.pts.map((p) => (
                  <li>{p}</li>
                ))}
              </ul>
            </article>
          ))
        }
      </div>
    </section>

    <!-- projects -->
    <section class="mt-12">
      <div class="mb-2 flex items-baseline justify-between">
        <h2
          class="text-xs font-semibold uppercase tracking-[0.18em] dark:text-neutral-300 text-neutral-500"
        >
          Selected Projects
        </h2>
        <a href="/projects" class="flex text-sm underline underline-offset-4"
          ><ArrowRight size="20" class="mr-1" />See All</a
        >
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {projects.map((p) => <Project {...p} />)}
      </div>
    </section>

    <!-- research exp. -->
    <section class="mt-10">
      <h2
        class="text-xs font-semibold uppercase tracking-[0.18em] dark:text-neutral-300 text-neutral-500"
      >
        Research
      </h2>
      <ul class="mt-3 list-disc pl-5 space-y-1">
        {research.map((r) => <li>{r}</li>)}
      </ul>
    </section>

    <!-- leadership -->
    <section class="mt-10">
      <h2
        class="text-xs font-semibold uppercase tracking-[0.18em] dark:text-neutral-300 text-neutral-500"
      >
        Leadership & Community
      </h2>
      <ul class="mt-3 list-disc pl-5 space-y-1">
        {leadership.map((l) => <li>{l}</li>)}
      </ul>
    </section>

    <!-- education -->
    <section class="mt-10">
      <h2
        class="text-xs font-semibold uppercase tracking-[0.18em] dark:text-neutral-300 text-neutral-500"
      >
        Education & Courses
      </h2>
      <div class="mt-3 grid gap-3">
        {
          education.map((ed) => (
            <div class="rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-4">
              <div class="flex flex-wrap items-baseline justify-between gap-2">
                <h3 class="font-semibold">{ed.school}</h3>
                <span class="text-xs text-neutral-500">{ed.loc}</span>
              </div>
              <p class="text-sm text-neutral-600 dark:text-neutral-300">
                {ed.sub}
              </p>
              <ul class="mt-2 list-disc pl-5 space-y-1">
                {ed.items.map((it) => (
                  <li>{it}</li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>
    </section>

    <!-- skills -->
    <section class="mt-10">
      <h2
        class="text-xs font-semibold uppercase tracking-[0.18em] dark:text-neutral-300 text-neutral-500"
      >
        Skills
      </h2>
      <div class="mt-3 grid sm:grid-cols-2 gap-3">
        {
          skills.map((s) => (
            <div class="rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-4">
              <span class="font-semibold">{s.k}:</span>
              <span class="text-neutral-700 dark:text-neutral-300"> {s.v}</span>
            </div>
          ))
        }
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="mt-12 text-xs dark:text-neutral-300 text-neutral-500">
      Last updated {new Date().toISOString().slice(0, 10)} •
      <a
        class="underline underline-offset-2"
        href={me.github}
        rel="me noopener"
      >
        GitHub</a
      > •
      <a class="underline underline-offset-2" href={me.blog} rel="noopener">
        Blog</a
      >
    </footer>
  </main>

  <script is:inline>
    const npLoading = document.getElementById("np-loading");
    const npLink = document.getElementById("np-link");

    function setNowPlaying(text, href) {
      if (npLoading) npLoading.style.display = "none";
      if (!npLink) return;
      npLink.textContent = text;
      npLink.href = href || "#";
      npLink.style.opacity = "1";
      if (href) npLink.setAttribute("target", "_blank");
    }

    function getDisplay(song) {
      try {
        const details = song?.details;
        if (song?.statusCode === 200 && details?.url) {
          return {
            text: ` ${details.name} by ${details.artists.join(", ")}`,
            url: details.url,
          };
        }
      } catch {}
      return { text: " Silence…", url: undefined };
    }

    try {
      const es = new EventSource("https://np.vsahni.me/sse");
      es.onmessage = (e) => {
        const payload = JSON.parse(e.data);
        const { text, url } = getDisplay(payload);
        setNowPlaying(text, url);
      };
      es.onerror = () => {
        es.close();
        fallbackPoll();
      };
    } catch {
      fallbackPoll();
    }

    async function fallbackPoll() {
      try {
        const res = await fetch("https://np.vsahni.me", { cache: "no-store" });
        const data = await res.json();
        const { text, url } = getDisplay(data);
        setNowPlaying(text, url);
      } catch {
        setNowPlaying(" Silence…");
      }
    }
  </script>
</Layout>
